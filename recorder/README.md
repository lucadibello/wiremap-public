# Recorder <!-- omit in toc -->

A GoLang + GraphQL + gRPC microservice for recording scans and unique hosts into PostgreSQL to later be fetched by the user through APIs.

## Table of Contents <!-- omit in toc -->

- [1. Tech stack](#1-tech-stack)
- [2. Configuration](#2-configuration)
- [3. Directory structure](#3-directory-structure)

## 1. Tech stack

- [GoLang](https://golang.org/), GoLang is a statically typed, compiled programming language designed at Google by Robert Griesemer, Rob Pike, and Ken Thompson. It is a syntactically simple, compiled language with garbage collection, limited structural typing, memory safety features and CSP-style concurrent programming features added to the language.
  - [Ent](https://entgo.io/), Ent is an entity framework for Go. It provides an intuitive API for building SQL-based data access layers with Go.
  - [gqlgen](https://gqlgen.com/), gqlgen is a Go library for building GraphQL servers without any fuss. It works with any object graph, and has deep integration with the standard library and popular third party libraries.
  - [pq](https://github.com/lib/pq), pq is a pure Go Postgres driver for the database/sql package.
- [GraphQL](https://graphql.org/), GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools.
- [PostgreSQL](https://www.postgresql.org/), PostgreSQL is a powerful, open source object-relational database system with over 30 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.
- [Docker Compose](https://docs.docker.com/compose/), Docker Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.
- [gRPC](https://grpc.io/), gRPC is a modern open source high performance RPC framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services.

## 2. Configuration

To configure the application in the right way, you need to create a `config.yaml` file in the root of the project. You can use the `config.yaml.example` file as a template.

```bash
cp config.yaml.example config.yaml
```

To learn more about the configuration of `Recorder` microservice, please read the configuration manual [here](./configs/README.md).

## 3. Directory structure

The directory structure of the `recorder` microservice is as follows:

```bash
.
└── recorder/ # Recorder microservice.
    ├── cmd/
    │   ├── composer # Composer CLI to merge all graphql schemas into one.
    │   └── recorder # Recorder microservice entrypoint.
    ├── configs # Configuration files.
    ├── ent/ # Ent ORM files.
    │   ├── enttest # Generated by Ent.
    │   ├── hook # Generated by Ent.
    │   ├── host # Generated by Ent.
    │   ├── migrate # Generated by Ent.
    │   ├── predicate # Generated by Ent.
    │   ├── runtime # Generated by Ent.
    │   ├── scan # Generated by Ent.
    │   └── schema # Schema files for Ent.
    └── internal/
        ├── chi/ # Chi Router utilities.
        │   └── middlewares # Custom Chi Router middlewares.
        ├── config # Package used to load the configuration.
        ├── graph/ # GraphQL utilities.
        │   ├── generated # gqpgen generated files.
        │   ├── resolvers # GraphQL resolvers.
        │   └── schemas # GraphQL schemas.
        ├── grpc # gRPC server implementation.
        ├── keycloak # Keycloak authentication/authorization
        ├── logger # Custom logger.
        ├── postgres # PostgreSQL database connection.
        ├── routes # Chi HTTP routes.
        └── splashscreen # Splashscreen utilities.
```
